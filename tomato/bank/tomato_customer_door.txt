@name Tomato Customer Door
@outputs Door
@persist [DB]:table
@persist [DSGroup Hash]:string
@persist [Player]:entity

if (~EGP) {reset()}
if(first() || dupefinished()) {
    #include "library/tomato_lib"
    #Global variables
    
    BankName = "BetterBank"
    Prefix = BankName
    
    dsJoinGroup("tomatobankinggroup")
    
    Hash = "doors"+toString(randint(1000000,9999999))
    
    function entity doorCheck(Radius) {
        local Min = entity():aabbWorldMin() - vec(Radius, Radius, 0)
        local Max = entity():aabbWorldMax() + vec(Radius, Radius, 50)
        findIncludeClass("player")
        findInBox(Min, Max)
        return findResult(1)
    }
    
    dsSend("req", DSGroup, Hash)
}

interval(100)

if(dsClk(Hash)) {
    DB = dsGetTable()
}

    local Player = doorCheck(50) 
    local Players = array()
    local Vaults = DB["Vaults",table]
    for (I=1, Vaults:count()) {
        Players:pushEntity(Vaults[I,table]["Account", entity])
    }
    if (Players:find(Player) || DB["Staff",table]:exists(Player:steamID64())) {
        if (Player:keyPressed("e")) {
            Door = 1
            timer("door", 4000)
        }
    }

if(clk("door")) {
    Door = 0
}

