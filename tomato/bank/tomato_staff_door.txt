@name Tomato Staff Door
@inputs Entry:entity
@outputs Door
@persist [DB]:table
@persist [DSGroup Hash]:string
@persist [Player]:entity

if (~EGP) {reset()}
if(first() || dupefinished()) {
    #include "library/tomato_lib"
    #Global variables
    
    BankName = "BetterBank"
    Prefix = BankName
    
    dsJoinGroup("tomatobankinggroup")
    
    Hash = "doors"+toString(randint(1000000,9999999))
    
    function entity doorCheck(Entity:entity, Radius) {
        local Min = entity():aabbWorldMin() - vec(Radius, Radius, Radius)
        local Max = entity():aabbWorldMax() + vec(Radius, Radius, Radius)
        findIncludeClass("player")
        findInBox(Min, Max)
        return findResult(1)
    }
    
    dsSend("req", DSGroup, Hash)
}

interval(100)

if(dsClk(Hash)) {
    DB = dsGetTable()
}

if (Entry:isValid()) {
    local Player = doorCheck(Entry, 50) 
    local Staff = DB["Staff", table]
    if (Staff:exists(Player:steamID64())) {
        if (Player:keyPressed("e")) {
            Door = 1
            timer("door", 4000)
        }
    }
}

if(clk("door")) {
    Door = 0
}

