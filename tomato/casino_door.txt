@name Door
@inputs Entry:entity 
@outputs Door
@persist Door Players:array Player:entity
@trigger 
@strict

if (~EGP) {reset()}
if (first()) {
    #include "library/tomato_lib"
    Prefix = "Casino"
    Dark = vec(40,40,40)
    Primary = vec(0,0,0)
    
    function entity doorCheck(Entity:entity, Radius) {
        local Min = Entity:aabbWorldMin() - vec(Radius, Radius, Radius)
        local Max = Entity:aabbWorldMax() + vec(Radius, Radius, Radius)
        findIncludeEntity(Player)
        findInBox(Min, Max)
        return findResult(1)
    }
    
    function background() {
        EGP:egpClear()
        createBox("Background",size(vec2(ScreenXY,ScreenXY)), color(Dark), coords(vec2(0,0)))
        createText("Purchase Access",size(50),align(1),coords(vec2(ScreenXY/2,ScreenXY/2-25))) 
        createBox("Bar1",size(vec2(10,ScreenXY)), color(Primary), coords(vec2(0,0)))
        createBox("Bar2",size(vec2(10,ScreenXY)), color(Primary), coords(vec2(ScreenXY-10,0)))
        createBox("Bar3",size(vec2(ScreenXY,10)), color(Primary), coords(vec2(0,0)))
        createBox("Bar4",size(vec2(ScreenXY,10)), color(Primary), coords(vec2(0,ScreenXY-10)))
        EGP:egpFont(Elements:get("Purchase Access"), "Roboto")
    }
    
    background()
}

interval(100)

for (I=1, 4) {
    local BarID = Elements:get("Bar"+I)
    if (Door) {
        EGP:egpColor(BarID, Green)
    }
    else {
        EGP:egpColor(BarID, vec(127.5 * sin(360 * 0.1 * curtime()) + 127.5,0,0))
    }
}

if (~User) {
    if (User:isValid()) {
        if (Players:find(User)) {
            User:msg("You have already purchased access!")
        }
        else {
            Player = User
            moneyRequest(User,10000)
        }
    }
}

if (moneyClk()) {
    EGP:egpSetText(Elements:get("Purchase Access"), "Thank you!")
    owner():msg(Player:name() + " was added to the door list")
    Players:pushEntity(Player)
    timer("message", 2000)
}

if (Entry:isValid()) {
    local Player = doorCheck(Entry, 50) 
    if (Players:find(Player)) {
        Door = 1
        timer("door", 4000)
    }
}

if(clk("message")) {
    EGP:egpSetText(Elements:get("Purchase Access"), "Purchase Access")
}

if(clk("door")) {
    Door = 0
}
