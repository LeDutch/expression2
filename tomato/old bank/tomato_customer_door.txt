@name Tomato Customer Door
@outputs Door
@persist [DB]:table
@persist [Player]:entity

if (~EGP) {reset()}
if(first() || dupefinished()) {
    #include "library/tomato_lib"
    #Global variables
    
    BankName = "BetterBank"
    Prefix = BankName
    
    function entity doorCheck(Radius) {
        local Min = entity():aabbWorldMin() - vec(Radius, Radius, 0)
        local Max = entity():aabbWorldMax() + vec(Radius, Radius, 50)
        findIncludeClass("player")
        findInBox(Min, Max)
        return findResult(1)
    }
    
    broadcastRemoteEvent(table())
}

interval(100)

event remote(Sender:entity, Player:entity, Payload:table) {
    if (Player == owner()) {
        DB = Payload
    }
}

    local Player = doorCheck(50) 
    local Players = array()
    local Vaults = DB["Vaults",table]
    for (I=1, Vaults:count()) {
        Players:pushEntity(Vaults[I,table]["Account", entity])
    }
    if (Players:find(Player) || DB["Staff",table]:exists(Player:steamID())) {
        if (Player:keyPressed("e")) {
            Door = 1
            timer("door", 4000)
        }
    }

if(clk("door")) {
    Door = 0
}

