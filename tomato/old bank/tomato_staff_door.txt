@name Tomato Staff Door
@inputs Entry:entity
@outputs Door
@persist [DB]:table
@persist [Player]:entity

if (~EGP) {reset()}
if(first() || dupefinished()) {
    #include "library/tomato_lib"
    #Global variables
    
    BankName = "BetterBank"
    Prefix = BankName
    
    function entity doorCheck(Entity:entity, Radius) {
        local Min = entity():aabbWorldMin() - vec(Radius, Radius, Radius)
        local Max = entity():aabbWorldMax() + vec(Radius, Radius, Radius)
        findIncludeClass("player")
        findInBox(Min, Max)
        return findResult(1)
    }
    
    broadcastRemoteEvent(table())
}

interval(100)

event remote(Sender:entity, Player:entity, Payload:table) {
    if (Player == owner()) {
        DB = Payload
    }
}

if (Entry:isValid()) {
    local Player = doorCheck(Entry, 50) 
    local Staff = DB["Staff", table]
    if (Staff:exists(Player:steamID())) {
        if (Player:keyPressed("e")) {
            Door = 1
            timer("door", 4000)
        }
    }
}

if(clk("door")) {
    Door = 0
}

